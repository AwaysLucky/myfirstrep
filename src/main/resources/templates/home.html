<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>è´­ç‰©å•†åŸ - é¦–é¡µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* å…¨å±€æ ·å¼ */
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    /* å¯¼èˆªæ æ ·å¼ */
    .navbar {
      background-color: #2c3e50;
      padding: 15px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav-container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .logo {
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 15px;
    }

    .nav-link {
      color: #ecf0f1;
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 4px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      font-size: 0.95rem;
    }

    .nav-link:hover,
    .nav-link.active-link {
      background-color: #3498db;
    }

    .nav-link span.icon {
      margin-right: 6px;
      font-size: 1.1em;
    }

    /* ä¸»è¦å†…å®¹åŒºåŸŸ */
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    /* æ¬¢è¿ä¿¡æ¯ */
    .welcome-section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .welcome-section h1 {
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .welcome-section p {
      color: #7f8c8d;
      margin-top: 0;
    }

    /* åˆ†ç±»å¯¼èˆª */
    .category-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
    }

    .category-btn {
      padding: 8px 15px;
      background-color: #ecf0f1;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .category-btn:hover {
      background-color: #3498db;
      color: white;
    }

    .category-btn.active-category {
      background-color: #3498db;
      color: white;
    }

    /* å•†å“å¡ç‰‡ */
    .products-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .product-card {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .product-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-bottom: 1px solid #eee;
    }

    .product-info {
      padding: 15px;
    }

    .product-name {
      font-size: 1.1rem;
      margin: 0 0 10px 0;
      color: #2c3e50;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .product-price {
      color: #e74c3c;
      font-weight: bold;
      font-size: 1.2rem;
      margin: 10px 0;
    }

    .product-rating {
      display: flex;
      align-items: center;
      color: #f39c12;
      font-size: 0.9rem;
    }

    .star-icon {
      margin-right: 5px;
    }

    /* åº•éƒ¨æ ·å¼ */
    .footer {
      text-align: center;
      padding: 20px;
      margin-top: 40px;
      background-color: #2c3e50;
      color: white;
    }

    .logout-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 8px 20px;
      background-color: #e74c3c;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #c0392b;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .nav-container {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .products-container {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }
  </style>
</head>
<body>

<!-- å¯¼èˆªæ  -->
<nav class="navbar">
  <div class="nav-container">
    <a href="/home" class="logo">è´­ç‰©å•†åŸ</a>
    <div class="nav-links">
      <a href="/home" class="nav-link active-link"><span class="icon">ğŸ </span>é¦–é¡µ</a>
      <a href="/orders" class="nav-link"><span class="icon">ğŸ“¦</span>è®¢å•æŸ¥çœ‹</a>
      <a href="/profile" class="nav-link"><span class="icon">ğŸ‘¤</span>ä¸ªäººä¿¡æ¯</a>
      <a href="/cart" class="nav-link"><span class="icon">ğŸ›’</span>è´­ç‰©è½¦</a>
      <a href="/login" class="logout-btn">é€€å‡ºç™»å½•</a>
    </div>
  </div>
</nav>
<!-- ä¸»è¦å†…å®¹ -->
<div class="container">
  <!-- æ¬¢è¿ä¿¡æ¯ -->
  <div class="welcome-section">
    <h1>æ¬¢è¿æ‚¨, <span th:text="${username}">User</span>!</h1>
    <p>å‘ç°æœ€æ–°æœ€çƒ­çš„å•†å“ï¼Œäº«å—è´­ç‰©ä¹è¶£</p>
  </div>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <div class="category-nav">
    <button class="category-btn active-category" onclick="loadProductsByCategory('')">çƒ­é—¨å•†å“</button>
    <button th:each="category : ${categories}"
            th:text="${category}"
            th:data-category="${category}"
            onclick="loadProductsByCategory(this.getAttribute('data-category'))"
            class="category-btn"></button>
  </div>

  <!-- å•†å“å±•ç¤º -->
  <h2 style="color: #2c3e50; margin-bottom: 15px;">å•†å“å±•ç¤º</h2>
  <div id="products-container" class="products-container">
    <!-- åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºçš„å•†å“ -->
    <div th:each="product : ${products}" class="product-card">
      <a th:href="@{/product/{id}(id=${product.productId})}">
        <img th:src="${product.imageUrl}" alt="å•†å“å›¾ç‰‡" class="product-image">
        <div class="product-info">
          <h3 class="product-name" th:text="${product.name}"></h3>
          <p class="product-price" th:text="'Â¥' + ${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}"></p>
          <div class="product-rating">
            <span class="star-icon">â˜…</span>
            <span th:text="${product.totalScore} + ' (' + ${product.ratingCount} + 'æ¬¡æµè§ˆ)'"></span>
          </div>
        </div>
      </a>
    </div>
  </div>
</div>

<!-- é¡µè„šä¿æŒä¸å˜ -->
<footer class="footer">
  <p>Â© 2025 è´­ç‰©å•†åŸ ç‰ˆæƒæ‰€æœ‰lry</p>
</footer>

<script>
  function loadProductsByCategory(category) {
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.classList.remove('active-category');
    });
    event.currentTarget.classList.add('active-category');

    // æ„å»ºè¯·æ±‚URL
    let url = '/api/products';
    if (category) {
      url += '?category=' + encodeURIComponent(category);
    }

    // å‘é€è¯·æ±‚
    fetch(url)
            .then(response => {
              if (!response.ok) {
                throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
              }
              return response.json();
            })
            .then(products => {
              const container = document.getElementById('products-container');
              container.innerHTML = '';

              if (products.length === 0) {
                container.innerHTML = '<p style="grid-column:1/-1;text-align:center;">æš‚æ— å•†å“</p>';
                return;
              }

              products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';

                // åˆ›å»ºå•†å“å¡ç‰‡å†…å®¹ - ç¡®ä¿åŒ…å«è¯¦æƒ…é¡µé“¾æ¥
                const productLink = document.createElement('a');
                productLink.href = `/product/${product.productId}`;

                // åˆ¤æ–­å½“å‰æ˜¯å¦ä¸º"çƒ­é—¨å•†å“"(å³categoryä¸ºç©º)
                if (!category || category === '') {
                  // æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯(å«è¯„åˆ†)
                  productLink.innerHTML = `
              <img src="${product.imageUrl || '/images/default-product.png'}"
                   alt="${product.name}"
                   class="product-image">
              <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
                <p class="product-price">Â¥${product.price.toFixed(2)}</p>
                <div class="product-rating">
                  <span class="star-icon">â˜…</span>
                  <span>${product.totalScore || 0} (${product.ratingCount || 0}äººè¯„ä»·)</span>
                </div>
              </div>
            `;
                } else {
                  // åªæ˜¾ç¤ºå›¾ç‰‡å’Œåç§°
                  productLink.innerHTML = `
              <img src="${product.imageUrl || '/images/default-product.png'}"
                   alt="${product.name}"
                   class="product-image">
              <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
              </div>
            `;
                }

                card.appendChild(productLink);
                container.appendChild(card);
              });
            })
            .catch(error => {
              console.error('åŠ è½½å•†å“å¤±è´¥:', error);
              document.getElementById('products-container').innerHTML =
                      '<p style="grid-column:1/-1;text-align:center;color:red;">åŠ è½½å•†å“å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>';
            });
  }

  // åˆå§‹åŠ è½½çƒ­é—¨å•†å“
  document.addEventListener('DOMContentLoaded', () => {
    // å¦‚æœå·²ç»æœ‰åˆå§‹å•†å“ï¼Œåˆ™ä¸éœ€è¦å†æ¬¡åŠ è½½
    if (document.querySelectorAll('.product-card').length === 0) {
      loadProductsByCategory('');
    }
  });
</script>
</body>
</html>